# 总线

CPU 所代表的控制器和运算器，需要和存储器(也就是主内存),以及输入输出设备进行通信，而通信所依赖的就是**总线**。

## 设计思路

计算机里有很多不同的硬件设备，如果各个设备间的通信都是互相之间单独进行，那么假设我们有 N 个不同的设备，它们之间需要各自单独连接，那么系统复杂度就会变成 N^2^。

为了简化系统复杂度，我们引入了总线，把复杂度降低到 N。

那怎么降低复杂度呢？与其让各个设备之间互相单独通信，不如我们去设计一个公用的线路。CPU 想要和什么设备通信，通信的指令是什么，对应的数据是什么，都发送到这个线路上；设备要向 CPU 发送什么信息呢，也发送到这个线路上。这个线路就好像一个高速公路，各个设备和其他设备之间，不需要单独建公路，只建一条小路通向这条高速公路就好了。

<img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gb572sn1fhj30u01bon4p.jpg" style="zoom:50%;" />

## 多总线架构

现代的 Intel CPU 的体系结构里面，通常有好几条总线。

首先，CPU 和内存以及高速缓存通信的总线，这里面通常由两种总线。这种方式，我们称为**双独立总线**（Dual Independent Bus，缩写为 DIB）。CPU 里，有一个快速的**本地总线**（Local Bus），以及一个速度相对较慢的**前端总线**（Front-side Bus）。

现代的 CPU 里，通常有专门的高速缓存芯片。这里的高速本地总线，就是用来和高速缓存通信的。而前端总线，则是用来和主内存以及输入输出设备通信的。有时候，我们会把本地总线也叫作后端总线（Back-side Bus），和前面的前端总线对应起来。而前端总线也有很多其他名字，比如处理器总线（Processor Bus）、内存总线（Memory Bus）。

![](https://tva1.sinaimg.cn/large/006tNbRwgy1gb578barj1j31bg0u00vw.jpg)

CPU 里面的北桥芯片，把前端总线，一分为二，变成了三个总线。

前端总线其实就是系统总线。CPU 里面的内存接口，直接和系统总线通信，然后系统总线再接入一个 I/O 桥接器（I/O Bridge）。这个 I/O 桥接器，一边接入了内存总线，使 CPU 和内存通信；另一边，接入了一个 I/O 总线，用来连接 I/O 设备。

事实上，真实的计算机里，这个总线层面拆分得更细。根据不同的设备，还会分成独立的 PCI 总线、ISA 总线等等。

![](https://tva1.sinaimg.cn/large/006tNbRwgy1gb57sgw1g8j313u0u0dhp.jpg)

## 三类线路

在物理层面，其实我们完全可以把总线看作一组“电线”。不过呢，这些电线之间也是有分工的，通常有三类线路：

- **数据线(Data Bus)** 用来传输实际的数据信息；
- **地址线(Address Bus)** 用来确定到底把数据传输到哪里去，是内存的某个位置，还是某一个 I/O 设备；
- **控制线(Control Bus)** 用来控制对于总线的访问。

尽管总线减少了设备之间的耦合，也降低了系统设计的复杂度，但同时也带来了一个新问题，那就是总线不能同时给多个设备提供通信功能。

我们的总线是很多个设备公用的，那多个设备都想要用总线，我们就需要有一个机制，去决定这种情况下，到底把总线给哪一个设备用。这个机制，就叫作**总线裁决(Bus Arbitraction)**。